<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO Debug</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { font-family: monospace; margin: 20px; background: #1e1e1e; color: #d4d4d4; }
        h1 { color: #569cd6; }
        .container { display: flex; gap: 20px; }
        .panel { flex: 1; }
        .status { padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .connected { background: #2d5a2d; }
        .disconnected { background: #5a2d2d; }
        button { background: #0e639c; color: white; border: none; padding: 8px 16px; cursor: pointer; margin: 5px; border-radius: 4px; }
        button:hover { background: #1177bb; }
        button:disabled { background: #555; cursor: not-allowed; }
        input, textarea { background: #3c3c3c; color: #d4d4d4; border: 1px solid #555; padding: 8px; width: 100%; margin: 5px 0; border-radius: 4px; }
        textarea { height: 100px; font-family: monospace; }
        #log { background: #252526; border: 1px solid #555; padding: 10px; height: 400px; overflow-y: auto; border-radius: 4px; }
        .log-entry { margin: 5px 0; padding: 5px; border-left: 3px solid #555; }
        .log-send { border-left-color: #4ec9b0; }
        .log-receive { border-left-color: #dcdcaa; }
        .log-error { border-left-color: #f14c4c; }
        .log-info { border-left-color: #569cd6; }
        .timestamp { color: #808080; font-size: 0.8em; }
        .event-name { color: #4ec9b0; font-weight: bold; }
        pre { margin: 5px 0; white-space: pre-wrap; word-break: break-all; }
    </style>
</head>
<body>
    <h1>Socket.IO Debug Console</h1>

    <div id="status" class="status disconnected">Disconnected</div>

    <div class="container">
        <div class="panel">
            <h3>Connection</h3>
            <input type="text" id="url" value="http://localhost:8000" placeholder="Server URL">
            <input type="text" id="path" value="/ws" placeholder="Socket.IO Path">
            <div>
                <button id="connectBtn" onclick="connect()">Connect</button>
                <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>
            </div>

            <h3>Send Event</h3>
            <input type="text" id="eventName" value="order.create" placeholder="Event name">
            <textarea id="eventData" placeholder="JSON data">{"item": "pizza", "quantity": 2}</textarea>
            <button onclick="sendEvent()" id="sendBtn" disabled>Send</button>

            <h3>Quick Actions</h3>
            <button onclick="quickSend('order.create', {item: 'burger', quantity: 1})" class="quick" disabled>Create Order</button>
            <button onclick="quickSend('order.list', {})" class="quick" disabled>List Orders</button>
            <button onclick="quickSend('order.get', {id: lastOrderId})" class="quick" disabled>Get Last Order</button>
            <button onclick="quickSend('order.update', {id: lastOrderId, status: 'completed'})" class="quick" disabled>Update Last Order</button>
            <button onclick="quickSend('order.delete', {id: lastOrderId})" class="quick" disabled>Delete Last Order</button>
        </div>

        <div class="panel">
            <h3>Log <button onclick="clearLog()" style="font-size: 0.8em; padding: 4px 8px;">Clear</button></h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        let socket = null;
        let lastOrderId = null;

        const events = [
            'order.created', 'order.list', 'order.data',
            'order.updated', 'order.deleted', 'order.error'
        ];

        function log(type, event, data) {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const time = new Date().toLocaleTimeString();
            entry.innerHTML = `
                <span class="timestamp">${time}</span>
                <span class="event-name">${event}</span>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function setConnected(connected) {
            const status = document.getElementById('status');
            status.textContent = connected ? 'Connected' : 'Disconnected';
            status.className = `status ${connected ? 'connected' : 'disconnected'}`;
            document.getElementById('connectBtn').disabled = connected;
            document.getElementById('disconnectBtn').disabled = !connected;
            document.getElementById('sendBtn').disabled = !connected;
            document.querySelectorAll('.quick').forEach(btn => btn.disabled = !connected);
        }

        function connect() {
            const url = document.getElementById('url').value;
            const path = document.getElementById('path').value;

            socket = io(url, { path: path });

            socket.on('connect', () => {
                log('info', 'connect', { sid: socket.id });
                setConnected(true);
            });

            socket.on('disconnect', (reason) => {
                log('info', 'disconnect', { reason });
                setConnected(false);
            });

            socket.on('connect_error', (error) => {
                log('error', 'connect_error', { message: error.message });
            });

            events.forEach(event => {
                socket.on(event, (data) => {
                    log('receive', event, data);
                    if (event === 'order.created' && data.id) {
                        lastOrderId = data.id;
                    }
                });
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }

        function sendEvent() {
            const event = document.getElementById('eventName').value;
            let data;
            try {
                data = JSON.parse(document.getElementById('eventData').value);
            } catch (e) {
                log('error', 'parse_error', { message: 'Invalid JSON' });
                return;
            }
            socket.emit(event, data);
            log('send', event, data);
        }

        function quickSend(event, data) {
            socket.emit(event, data);
            log('send', event, data);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
    </script>
</body>
</html>
